<!DOCTYPE html>
<html>
<head>
    <title>–ú–æ–π –ë–∏–∑–Ω–µ—Å</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h1>üì¶ –ú–æ–∏ –ó–∞–∫–∞–∑—ã</h1>
        
        <!-- –ë–ª–æ–∫ —Å –∫—É—Ä—Å–æ–º –≤–∞–ª—é—Ç -->
        <div class="alert alert-info d-flex justify-content-between align-items-center">
            <div>
                <strong>üí∞ –¢–µ–∫—É—â–∏–π –∫—É—Ä—Å:</strong> 1 CNY = {{ current_rate }} TJS
            </div>
            <div>
                <small>üîÑ –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ</small>
            </div>
        </div>
        
        <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ -->
        <div class="card mb-4">
            <div class="card-body">
                <h5>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –∑–∞–∫–∞–∑</h5>
                <form method="POST" action="/add_product">
                    <div class="row g-3">
                        <div class="col-md-2">
                            <input type="text" name="order_number" class="form-control" placeholder="–ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞" required>
                        </div>
                        <div class="col-md-3">
                            <input type="text" name="name" class="form-control" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞" required>
                        </div>
                        <div class="col-md-2">
                            <input type="number" step="0.01" name="price_cny" class="form-control" placeholder="–¶–µ–Ω–∞ –≤ —é–∞–Ω—è—Ö" required>
                        </div>
                        <div class="col-md-2">
                            <input type="number" name="quantity" class="form-control" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ" value="1" required>
                        </div>
                        <div class="col-md-2">
                            <input type="text" name="cargo" class="form-control" placeholder="–ö–∞—Ä–≥–æ –∫–æ–º–ø–∞–Ω–∏—è">
                        </div>
                        <div class="col-md-3">
                            <input type="text" name="customer_name" class="form-control" placeholder="–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å)">
                        </div>
                        <div class="col-md-2">
                            <button type="submit" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ -->
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>‚Ññ –ó–∞–∫–∞–∑–∞</th>
                        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                        <th>–¶–µ–Ω–∞ (¬•/TJS)</th>
                        <th>–ö–æ–ª-–≤–æ</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–ö–ª–∏–µ–Ω—Ç</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody>
                    {% for product in products %}
                    <tr>
                        <td>{{ product.order_number }}</td>
                        <td>{{ product.name }}</td>
                        <td>{{ product.price_cny|round(2) }}¬• / {{ product.price_tjs|round(2) }}TJS</td>
                        <td>{{ product.quantity }}</td>
                        <td>
                            <span class="badge 
                                {% if product.status == 'ordered' %}bg-secondary
                                {% elif product.status == 'in_china' %}bg-warning
                                {% elif product.status == 'in_transit' %}bg-info
                                {% elif product.status == 'received' %}bg-primary
                                {% else %}bg-success{% endif %}">
                                {{ product.status }}
                            </span>
                        </td>
                        <td>{{ product.customer_name or '-' }}</td>
                        <td>
                            <form method="POST" action="/update_status/{{ product.id }}">
                                <select name="status" class="form-select form-select-sm">
                                    <option value="ordered" {% if product.status == 'ordered' %}selected{% endif %}>–ó–∞–∫–∞–∑–∞–Ω</option>
                                    <option value="in_china" {% if product.status == 'in_china' %}selected{% endif %}>–í –ö–∏—Ç–∞–µ</option>
                                    <option value="in_transit" {% if product.status == 'in_transit' %}selected{% endif %}>–í –ø—É—Ç–∏</option>
                                    <option value="received" {% if product.status == 'received' %}selected{% endif %}>–ü–æ–ª—É—á–µ–Ω</option>
                                </select>
                                
                                {% if product.status == 'in_transit' %}
                                <input type="text" name="track_code" class="form-control form-control-sm mt-1" placeholder="–¢—Ä–µ–∫ –∫–æ–¥">
                                {% endif %}
                                
                                {% if product.status == 'received' %}
                                <input type="number" step="0.01" name="shipping_price" class="form-control form-control-sm mt-1" placeholder="–¶–µ–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∏">
                                <input type="number" step="0.01" name="weight" class="form-control form-control-sm mt-1" placeholder="–í–µ—Å (–∫–≥)">
                                
                                <!-- –§–û–†–ú–ê –ü–†–û–î–ê–ñ–ò -->
                                <div class="border-top mt-2 pt-2">
                                    <input type="text" name="customer_name" class="form-control form-control-sm mb-1" 
                                           placeholder="–ö–ª–∏–µ–Ω—Ç –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏" value="{{ product.customer_name }}">
                                    <input type="number" step="0.01" name="sale_price" class="form-control form-control-sm mb-1" 
                                           placeholder="–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏">
                                    <button type="submit" class="btn btn-success btn-sm w-100">üí∞ –ü—Ä–æ–¥–∞—Ç—å</button>
                                </div>
                                {% endif %}
                                
                                <button type="submit" class="btn btn-primary btn-sm mt-1 w-100">–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
        <div class="mt-4">
            <a href="/sales" class="btn btn-outline-primary">üìä –ü—Ä–æ–¥–∞–∂–∏</a>
            <a href="/customers" class="btn btn-outline-secondary">üë• –ö–ª–∏–µ–Ω—Ç—ã</a>
        </div>
    </div>
</body>
</html>