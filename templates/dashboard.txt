<!DOCTYPE html>
<html>
<head>
    <title>–î–∞—à–±–æ—Ä–¥ - –ú–æ–π –ë–∏–∑–Ω–µ—Å</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ –¥–ª—è –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
        .stat-card { 
            color: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            text-align: center;
            transition: transform 0.2s;
        }
        .stat-card:hover {
            transform: translateY(-2px);
        }
        .stat-number { 
            font-size: 1.5rem; 
            font-weight: bold; 
        }
        .progress { height: 8px; margin-top: 5px; }
        
        /* –ú–æ–±–∏–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ */
        @media (max-width: 768px) {
            .mobile-card {
                border: 1px solid #ddd;
                border-radius: 10px;
                padding: 15px;
                margin-bottom: 15px;
                background: white;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            .nav-buttons {
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                gap: 5px;
                margin-bottom: 15px;
            }
            .nav-buttons .btn {
                font-size: 0.8rem;
                padding: 6px 8px;
            }
            .quick-actions {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
                margin-top: 15px;
            }
            .desktop-view { display: none; }
        }
        
        /* –î–µ—Å–∫—Ç–æ–ø–Ω—ã–µ —Å—Ç–∏–ª–∏ */
        @media (min-width: 769px) {
            .container { max-width: 1200px; }
            .nav-buttons {
                display: flex;
                gap: 10px;
                margin-bottom: 25px;
                justify-content: center;
            }
            .nav-buttons .btn {
                font-size: 1rem;
                padding: 10px 20px;
                min-width: 120px;
            }
            .desktop-grid {
                display: grid;
                grid-template-columns: 2fr 1fr;
                gap: 20px;
                align-items: start;
            }
            .main-stats {
                display: grid;
                grid-template-columns: repeat(4, 1fr);
                gap: 15px;
                margin-bottom: 20px;
            }
            .stat-card {
                padding: 20px;
            }
            .stat-number { 
                font-size: 2rem; 
            }
            .desktop-card {
                background: white;
                border-radius: 10px;
                padding: 20px;
                margin-bottom: 20px;
                box-shadow: 0 4px 6px rgba(0,0,0,0.1);
                border: 1px solid #e9ecef;
            }
            .mobile-view { display: none; }
        }
    </style>
</head>
<body>
    <div class="container mt-3">
        <h4 class="text-center mb-3">üìà –î–∞—à–±–æ—Ä–¥</h4>
        
        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
        <div class="nav-buttons">
            <a href="/orders" class="btn btn-outline-primary">üì¶ –ó–∞–∫–∞–∑—ã</a>
            <a href="/warehouse" class="btn btn-outline-warning">üè™ –°–∫–ª–∞–¥</a>
            <a href="/sales" class="btn btn-outline-success">üí∞ –ü—Ä–æ–¥–∞–∂–∏</a>
            <a href="/customers" class="btn btn-outline-info">üë• –ö–ª–∏–µ–Ω—Ç—ã</a>
        </div>

        <!-- –î–ï–°–ö–¢–û–ü–ù–ê–Ø –í–ï–†–°–ò–Ø -->
        <div class="desktop-view">
            <div class="desktop-grid">
                <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
                <div>
                    <!-- –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                    <div class="main-stats">
                        <div class="stat-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                            <div class="stat-number">{{ stats.total_products }}</div>
                            <small>–¢–æ–≤–∞—Ä—ã</small>
                        </div>
                        <div class="stat-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                            <div class="stat-number">{{ stats.total_customers }}</div>
                            <small>–ö–ª–∏–µ–Ω—Ç—ã</small>
                        </div>
                        <div class="stat-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                            <div class="stat-number">{{ stats.total_sales_count }}</div>
                            <small>–ü—Ä–æ–¥–∞–∂–∏</small>
                        </div>
                        <div class="stat-card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                            <div class="stat-number">{{ "%.0f"|format(stats.total_profit) }}</div>
                            <small>–ü—Ä–∏–±—ã–ª—å</small>
                        </div>
                    </div>

                    <!-- –§–∏–Ω–∞–Ω—Å—ã –∏ —Å—Ç–∞—Ç—É—Å—ã –≤ —Ä—è–¥ -->
                    <div class="row">
                        <div class="col-6">
                            <div class="desktop-card">
                                <h5>üí∞ –§–∏–Ω–∞–Ω—Å—ã</h5>
                                <div class="d-flex justify-content-between border-bottom py-2">
                                    <span>–í—ã—Ä—É—á–∫–∞:</span>
                                    <strong>{{ "%.0f"|format(stats.total_revenue) }} TJS</strong>
                                </div>
                                <div class="d-flex justify-content-between border-bottom py-2">
                                    <span>–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏:</span>
                                    <span>{{ "%.0f"|format(stats.total_investment) }} TJS</span>
                                </div>
                                <div class="d-flex justify-content-between border-bottom py-2">
                                    <span>–î–æ—Å—Ç–∞–≤–∫–∞:</span>
                                    <span>{{ "%.0f"|format(stats.total_shipping) }} TJS</span>
                                </div>
                                <div class="d-flex justify-content-between pt-2 mt-2 fw-bold fs-5">
                                    <span>–ü—Ä–∏–±—ã–ª—å:</span>
                                    <strong class="text-success">{{ "%.0f"|format(stats.total_profit) }} TJS</strong>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="desktop-card">
                                <h5>üìä –°—Ç–∞—Ç—É—Å—ã —Ç–æ–≤–∞—Ä–æ–≤</h5>
                                {% for status, count in stats.status_stats.items() %}
                                <div class="mb-3">
                                    <div class="d-flex justify-content-between">
                                        <span>
                                            {% if status == 'ordered' %}üü¢ –ó–∞–∫–∞–∑–∞–Ω–æ
                                            {% elif status == 'in_china' %}üü° –í –ö–∏—Ç–∞–µ
                                            {% elif status == 'in_transit' %}üîµ –í –ø—É—Ç–∏
                                            {% elif status == 'received' %}üü£ –ù–∞ —Å–∫–ª–∞–¥–µ
                                            {% elif status == 'sold' %}üü¢ –ü—Ä–æ–¥–∞–Ω–æ
                                            {% endif %}
                                        </span>
                                        <span>{{ count }}</span>
                                    </div>
                                    <div class="progress">
                                        <div class="progress-bar 
                                            {% if status == 'ordered' %}bg-secondary
                                            {% elif status == 'in_china' %}bg-warning
                                            {% elif status == 'in_transit' %}bg-info
                                            {% elif status == 'received' %}bg-primary
                                            {% elif status == 'sold' %}bg-success
                                            {% endif %}" 
                                            style="width: {{ (count/stats.total_products*100) if stats.total_products > 0 else 0 }}%">
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>

                    <!-- –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã -->
                    {% if stats.popular_products %}
                    <div class="desktop-card">
                        <h5>üî• –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã</h5>
                        <div class="row">
                            {% for product in stats.popular_products %}
                            <div class="col-6 mb-2">
                                <div class="d-flex justify-content-between align-items-center p-2 border rounded">
                                    <span>{{ product.name }}</span>
                                    <span class="badge bg-primary">{{ product.sales_count }} –ø—Ä–æ–¥–∞–∂</span>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                </div>

                <!-- –ë–æ–∫–æ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
                <div>
                    <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
                    <div class="desktop-card">
                        <h5>‚ö° –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h5>
                        <div class="d-grid gap-2">
                            <a href="/orders" class="btn btn-outline-primary">‚ûï –ù–æ–≤—ã–π –∑–∞–∫–∞–∑</a>
                            <a href="/warehouse" class="btn btn-outline-success">üí∞ –ü—Ä–æ–¥–∞—Ç—å —Ç–æ–≤–∞—Ä</a>
                            <a href="/customers" class="btn btn-outline-info">üë• –î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞</a>
                            <a href="/sales" class="btn btn-outline-warning">üìä –û—Ç—á–µ—Ç –ø—Ä–æ–¥–∞–∂</a>
                        </div>
                    </div>

                    <!-- –î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—Ö–æ–¥ -->
                    <div class="desktop-card">
                        <h5>üí∏ –î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—Ö–æ–¥</h5>
                        <form method="POST" action="/add_expense">
                            <div class="mb-2">
                                <input type="text" name="description" class="form-control" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ" required>
                            </div>
                            <div class="mb-2">
                                <input type="number" step="0.01" name="amount" class="form-control" placeholder="–°—É–º–º–∞ (TJS)" required>
                            </div>
                            <div class="mb-2">
                                <select name="category" class="form-select">
                                    <option value="delivery">–î–æ—Å—Ç–∞–≤–∫–∞</option>
                                    <option value="storage">–°–∫–ª–∞–¥</option>
                                    <option value="marketing">–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥</option>
                                    <option value="other">–î—Ä—É–≥–æ–µ</option>
                                </select>
                            </div>
                            <button type="submit" class="btn btn-warning w-100">–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—Ö–æ–¥</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ú–û–ë–ò–õ–¨–ù–ê–Ø –í–ï–†–°–ò–Ø -->
        <div class="mobile-view">
            <!-- –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <div class="row">
                <div class="col-6">
                    <div class="stat-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                        <div class="stat-number">{{ stats.total_products }}</div>
                        <small>–¢–æ–≤–∞—Ä—ã</small>
                    </div>
                </div>
                <div class="col-6">
                    <div class="stat-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                        <div class="stat-number">{{ stats.total_customers }}</div>
                        <small>–ö–ª–∏–µ–Ω—Ç—ã</small>
                    </div>
                </div>
                <div class="col-6">
                    <div class="stat-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                        <div class="stat-number">{{ stats.total_sales_count }}</div>
                        <small>–ü—Ä–æ–¥–∞–∂–∏</small>
                    </div>
                </div>
                <div class="col-6">
                    <div class="stat-card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                        <div class="stat-number">{{ "%.0f"|format(stats.total_profit) }}</div>
                        <small>–ü—Ä–∏–±—ã–ª—å</small>
                    </div>
                </div>
            </div>

            <!-- –§–∏–Ω–∞–Ω—Å—ã -->
            <div class="mobile-card">
                <h6>üí∞ –§–∏–Ω–∞–Ω—Å—ã</h6>
                <div class="small">
                    <div class="d-flex justify-content-between">
                        <span>–í—ã—Ä—É—á–∫–∞:</span>
                        <strong>{{ "%.0f"|format(stats.total_revenue) }} TJS</strong>
                    </div>
                    <div class="d-flex justify-content-between">
                        <span>–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏:</span>
                        <span>{{ "%.0f"|format(stats.total_investment) }} TJS</span>
                    </div>
                    <div class="d-flex justify-content-between">
                        <span>–î–æ—Å—Ç–∞–≤–∫–∞:</span>
                        <span>{{ "%.0f"|format(stats.total_shipping) }} TJS</span>
                    </div>
                    <div class="d-flex justify-content-between border-top pt-1 mt-1">
                        <span><strong>–ü—Ä–∏–±—ã–ª—å:</strong></span>
                        <strong class="text-success">{{ "%.0f"|format(stats.total_profit) }} TJS</strong>
                    </div>
                </div>
            </div>

            <!-- –°—Ç–∞—Ç—É—Å—ã —Ç–æ–≤–∞—Ä–æ–≤ -->
            <div class="mobile-card">
                <h6>üìä –°—Ç–∞—Ç—É—Å—ã —Ç–æ–≤–∞—Ä–æ–≤</h6>
                <div class="small">
                    <div class="mb-2">
                        <div class="d-flex justify-content-between">
                            <span>üü¢ –ó–∞–∫–∞–∑–∞–Ω–æ:</span>
                            <span>{{ stats.status_stats.ordered }}</span>
                        </div>
                        <div class="progress">
                            <div class="progress-bar bg-secondary" style="width: {{ (stats.status_stats.ordered/stats.total_products*100) if stats.total_products > 0 else 0 }}%"></div>
                        </div>
                    </div>
                    <div class="mb-2">
                        <div class="d-flex justify-content-between">
                            <span>üü° –í –ö–∏—Ç–∞–µ:</span>
                            <span>{{ stats.status_stats.in_china }}</span>
                        </div>
                        <div class="progress">
                            <div class="progress-bar bg-warning" style="width: {{ (stats.status_stats.in_china/stats.total_products*100) if stats.total_products > 0 else 0 }}%"></div>
                        </div>
                    </div>
                    <div class="mb-2">
                        <div class="d-flex justify-content-between">
                            <span>üîµ –í –ø—É—Ç–∏:</span>
                            <span>{{ stats.status_stats.in_transit }}</span>
                        </div>
                        <div class="progress">
                            <div class="progress-bar bg-info" style="width: {{ (stats.status_stats.in_transit/stats.total_products*100) if stats.total_products > 0 else 0 }}%"></div>
                        </div>
                    </div>
                    <div class="mb-2">
                        <div class="d-flex justify-content-between">
                            <span>üü£ –ù–∞ —Å–∫–ª–∞–¥–µ:</span>
                            <span>{{ stats.status_stats.received }}</span>
                        </div>
                        <div class="progress">
                            <div class="progress-bar bg-primary" style="width: {{ (stats.status_stats.received/stats.total_products*100) if stats.total_products > 0 else 0 }}%"></div>
                        </div>
                    </div>
                    <div class="mb-2">
                        <div class="d-flex justify-content-between">
                            <span>üü¢ –ü—Ä–æ–¥–∞–Ω–æ:</span>
                            <span>{{ stats.status_stats.sold }}</span>
                        </div>
                        <div class="progress">
                            <div class="progress-bar bg-success" style="width: {{ (stats.status_stats.sold/stats.total_products*100) if stats.total_products > 0 else 0 }}%"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã -->
            {% if stats.popular_products %}
            <div class="mobile-card">
                <h6>üî• –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã</h6>
                {% for product in stats.popular_products %}
                <div class="d-flex justify-content-between align-items-center py-1 border-bottom">
                    <span class="small">{{ product.name }}</span>
                    <span class="badge bg-primary">{{ product.sales_count }}</span>
                </div>
                {% endfor %}
            </div>
            {% endif %}

            <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
            <div class="mobile-card">
                <h6>‚ö° –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h6>
                <div class="quick-actions">
                    <a href="/orders" class="btn btn-outline-primary btn-sm">‚ûï –ó–∞–∫–∞–∑</a>
                    <a href="/warehouse" class="btn btn-outline-success btn-sm">üí∞ –ü—Ä–æ–¥–∞—Ç—å</a>
                    <a href="/customers" class="btn btn-outline-info btn-sm">üë• –ö–ª–∏–µ–Ω—Ç</a>
                    <a href="/sales" class="btn btn-outline-warning btn-sm">üìä –û—Ç—á–µ—Ç</a>
                </div>
            </div>

            <!-- –î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—Ö–æ–¥ -->
            <div class="mobile-card">
                <h6>üí∏ –î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—Ö–æ–¥</h6>
                <form method="POST" action="/add_expense">
                    <input type="text" name="description" class="form-control form-control-sm mb-1" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ" required>
                    <input type="number" step="0.01" name="amount" class="form-control form-control-sm mb-1" placeholder="–°—É–º–º–∞ (TJS)" required>
                    <select name="category" class="form-select form-select-sm mb-1">
                        <option value="delivery">–î–æ—Å—Ç–∞–≤–∫–∞</option>
                        <option value="storage">–°–∫–ª–∞–¥</option>
                        <option value="marketing">–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥</option>
                        <option value="other">–î—Ä—É–≥–æ–µ</option>
                    </select>
                    <button type="submit" class="btn btn-warning btn-sm w-100">–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—Ö–æ–¥</button>
                </form>
            </div>
        </div>
    </div>
</body>
</html>